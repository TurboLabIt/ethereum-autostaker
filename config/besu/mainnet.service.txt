[Unit]
Description=Besu (mainnet)
After=network.target 
Wants=network.target

[Service]
Type=simple
User=besu
Group=besu
Restart=on-failure
RestartSec=5
WorkingDirectory=/var/lib/besu
Environment="ClientIP=$(dig @resolver4.opendns.com myip.opendns.com +short)"
ExecStart=/bin/bash -c '/usr/local/besu/bin/besu --network=mainnet --data-path=/var/lib/besu --color-enabled=false --Xdata-storage-format=BONSAI --rpc-http-enabled=true --rpc-ws-enabled=true --nat-method=none --p2p-host=${ClientIP}'

[Install]
WantedBy=default.target
